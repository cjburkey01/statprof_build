<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>StatProf</title>

<link rel="stylesheet" href="./normalize_8.0.1.css" />
<link rel="stylesheet" href="./style.css" />
        <!-- HI! -->
    </head>
    <body>
        <div id="main_container">
            <div id="title">
                <h1>StatProf</h1>
            </div>

            <h2>Distributions</h2>

            <!-- Normal probability -->
<script type="text/hyperscript">
    behavior NormProb
    on norm_prob_update queue first
        set dist to the value of #norm_prob_calc_type
        set mean to the value of #norm_prob_calc_mean
        set stdev to the value of #norm_prob_calc_stdev
        set n to the value of #norm_prob_calc_n
        set gt to the value of #norm_prob_calc_gt
        set lt to the value of #norm_prob_calc_lt

        set the value of #norm_prob_output to ""
        set the value of #norm_prob_gt_zscore to ""
        set the value of #norm_prob_lt_zscore to ""

        if has_val(dist) and has_val(mean) and has_val(stdev) and has_val(n)
            set dist to Math.max(1, Math.min(2, dist as Int))
            set mean to mean as Float
            set n to Math.max(1, n as Int)
            set stdev to stdev as Float
            set stdev_n to stdev / Math.sqrt(n)

            if has_val(gt)
                set the value of norm_prob_gt_zscore to z_score_fn(mean, stdev_n, gt).toFixed(6)
            end
            if has_val(lt)
                set the value of norm_prob_lt_zscore to z_score_fn(mean, stdev_n, lt).toFixed(6)
            end

            set output to norm_prob_cdf_gt_lt(mean, stdev_n, gt, lt)
            if output exists
                set the value of #norm_prob_output to output.toFixed(6)
            end
        end
    end
end
</script>
<div id="norm_prob_calc">
    <h3>Normal Distribution P-Value</h3>
    <div class="wrapper" id="norm_prob_calc_wrapper" _="install NormProb">
        <p>
            Calculates the area under the normal probability density function,
            representing a probability value.
        </p>
        <p>
            Calculate the probability of randomly picking one value above,
            below, between, or outside of the given less than/greater than
            values, assuming the population is normally distributed.
        </p>
        <p>
            If a sample size is provided, the standard deviation is divided by 
            the square root of the sample size to calculate the probability of a
            random sample of the given sample size having a mean of the values
            below/above/between/outside what is specified in the
            <code>x &gt;</code> and <code>x &lt;</code> fields, assuming that
            the population is normally distributed or the sample size
            <code>n</code> &geq; 30, and the population standard deviation is 
            assumed to be what is provided. If the population standard deviation
            is unknown or <code>n</code> &lt; 30, you should use the Student
            T-Distribution.
        </p>
        <p>
            Think of the <code>x &gt;</code> and <code>x &lt;</code> fields as
            min and max fields, respectively. Filling in the <code>x &gt;</code>
            field will calculate the probability area from that point towards
            positive infinity. If both the greater than (min) and less than
            (max) fields are provided, the probability area either between or
            outside of the given points will be calculated.
        </p>
        <p>
            Leave either <code>x &gt;</code> or <code>x &lt;</code> blank to
            perform a one-tailed probability calculation, but at least one of
            these fields must be provided.
        </p>

        <table>
            <tbody>
                <tr>
                    <td class="row_label">
                        <label for="norm_prob_calc_type">
                            Distribution:
                        </label>
                    </td>
                    <td>
                        <select id="norm_prob_calc_type"
                                _="on change send norm_prob_update to #norm_prob_calc_wrapper">
                            <option value="1" selected>Normal (Gaussian) Distribution</option>
                            <!-- <option value="2">Student T-Distribution</option> -->
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="row_label">
                        <label for="norm_prob_calc_mean">
                            Mean (<code>&mu;</code>):
                        </label>
                    </td>
                    <td>
                        <input type="number"
                               id="norm_prob_calc_mean"
                               size="8"
                               step="1.0"
                               value="0.0"
                               _="on keyup or input send norm_prob_update to #norm_prob_calc_wrapper" />
                    </td>
                </tr>
                <tr>
                    <td class="row_label">
                        <label for="norm_prob_calc_stdev">
                            Standard Deviation (<code>&sigma;</code>):
                        </label>
                    </td>
                    <td>
                        <input type="number"
                               id="norm_prob_calc_stdev"
                               size="8"
                               step="0.1"
                               value="1.0"
                               _="on keyup or input send norm_prob_update to #norm_prob_calc_wrapper" />
                    </td>
                </tr>
                <tr>
                    <td class="row_label">
                        <label for="norm_prob_calc_n">
                            Sample Size (<code>n</code>):
                        </label>
                    </td>
                    <td>
                        <input type="number"
                               id="norm_prob_calc_n"
                               size="8"
                               step="1"
                               value="1"
                               min="1"
                               _="on keyup or input send norm_prob_update to #norm_prob_calc_wrapper" />
                    </td>
                    <td>
                        (Set to 1 if unsure)
                    </td>
                </tr>
                <tr>
                    <td class="row_label">
                        <label for="norm_prob_calc_gt">
                            x &gt;
                        </label>
                    </td>
                    <td>
                        <input type="number"
                               id="norm_prob_calc_gt"
                               size="8"
                               step="0.5"
                               _="on keyup or input send norm_prob_update to #norm_prob_calc_wrapper" />
                    </td>
                    <td>(May be blank)</td>
                </tr>
                <tr>
                    <td class="row_label">
                        <label for="norm_prob_calc_lt">
                            x &lt;
                        </label>
                    </td>
                    <td>
                        <input type="number"
                               id="norm_prob_calc_lt"
                               size="8"
                               step="0.5"
                               _="on keyup or input send norm_prob_update to #norm_prob_calc_wrapper" />
                    </td>
                    <td>(May be blank)</td>
                </tr>
                <tr>
                    <td class="row_label">
                        <label for="norm_prob_gt_zscore">
                            z<sub>x&gt;</sub> :
                        </label>
                    </td>
                    <td>
                        <input type="text"
                               id="norm_prob_gt_zscore"
                               size="10"
                               readonly />
                    </td>
                </tr>
                <tr>
                    <td class="row_label">
                        <label for="norm_prob_lt_zscore">
                            z<sub>x&lt;</sub> :
                        </label>
                    </td>
                    <td>
                        <input type="text"
                               id="norm_prob_lt_zscore"
                               size="10"
                               readonly />
                    </td>
                </tr>
                <tr>
                    <td class="row_label">
                        <label for="norm_prob_output">
                            Probability:
                        </label>
                    </td>
                    <td>
                        <input type="text"
                               id="norm_prob_output"
                               size="10"
                               readonly />
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
        </div>

        <footer>
            &copy 2023 CJ Burkey &verbar;
            Source available on <a target="_blank"
                                   title="View source on GitHub"
                                   href="https://github.com/cjburkey01/statprof_build">
                GitHub
            </a>
        </footer>

        <!-- Helpers -->
        <script type="text/hyperscript">
    def has_val(input)
        return input exists and input is not empty
    end

    def z_score_fn(mean, stdev, x)
        return (x as Float - mean as Float) / stdev as Float
    end

    def t_score_fn(mean, stdev, n, x)
        return (x as Float - mean as Float) / (stdev as Float / Math.sqrt(n))
    end

    def x_from_z(mean, stdev, z)
        -- z=(x-mean)/stdev
        -- z*stdev=(x-mean)
        -- z*stdev+mean=x
        return (mean as Float + (z as Float * stdev as Float))
    end

    def round(value, decimal_places)
        set local factor to Math.pow(10, decimal_places)
        return Math.round(value * factor) / factor
    end

    def norm_prob_cdf_fn(mean, stdev, x)
        return jStat.normal.cdf(x, mean, stdev)
    end

    def norm_prob_cdf_gt(mean, stdev, x)
        return 1.0 - jStat.normal.cdf(x, mean, stdev)
    end

    def norm_prob_cdf_btwn(mean, stdev, x1, x2)
        set min to Math.min(x1, x2)
        set max to Math.max(x1, x2)
        return norm_prob_cdf_fn(mean, stdev, max) 
                - norm_prob_cdf_fn(mean, stdev, min)
    end

    def norm_prob_cdf_outside(mean, stdev, x1, x2)
        return 1.0 - norm_prob_cdf_btwn(mean, stdev, x1, x2)
    end

    -- Either gt or lt may be undefined/null/"", this function can be 
    -- considered a general probability area calculator.
    -- If gt is less than lt, then we find P(gt<x<lt), which is between the two 
    -- values. If lt is less than t, we find the tail probabilities because 
    -- we find P(lt<x<gt), or 1.0-P(gt<x<lt), the inverse of the inner 
    -- probability between the two values.
    def norm_prob_cdf_gt_lt(mean, stdev, gt, lt)
        if has_val(lt) and has_val(gt)
            if gt <= lt
                -- If gt is less than lt, we want inner probability.
                return norm_prob_cdf_btwn(mean, stdev, gt, lt)
            else
                return norm_prob_cdf_outside(mean, stdev, gt, lt)
            end
        else if has_val(lt)
            return norm_prob_cdf_fn(mean, stdev, lt)
        else if has_val(gt)
            return norm_prob_cdf_gt(mean, stdev, gt)
        end
    end

    def inv_norm_cdf_fn(mean, stdev, p)
        return jStat.normal.inv(p, mean, stdev)
    end

    def inv_t_cdf_fn(n, p)
        return jStat.studentt.inv(p, n - 1)
    end

    def t_prob_cdf_fn(mean, stdev, n, x)
        return jStat.studentt.cdf(t_score_fn(mean, stdev, n, x), n - 1)
    end

    def t_prob_cdf_gt(mean, stdev, n, x)
        return 1.0 - jStat.studentt.cdf(t_score_fn(mean, stdev, n, x), n - 1)
    end

    def t_prob_cdf_btwn(mean, stdev, n, x1, x2)
        set min to Math.min(x1, x2)
        set max to Math.max(x1, x2)
        return t_prob_cdf_fn(mean, stdev, n, max) 
                - t_prob_cdf_fn(mean, stdev, n, min)
    end

    def t_prob_cdf_outside(mean, stdev, n, x1, x2)
        return 1.0 - t_prob_cdf_btwn(mean, stdev, n, x1, x2)
    end

    def t_prob_cdf_gt_lt(mean, stdev, gt, lt)
        if has_val(lt) and has_val(gt)
            if gt <= lt
                -- If gt is less than lt, we want inner probability.
                return t_prob_cdf_btwn(mean, stdev, gt, lt)
            else
                return t_prob_cdf_outside(mean, stdev, gt, lt)
            end
        else if has_val(lt)
            return t_prob_cdf_fn(mean, stdev, lt)
        else if has_val(gt)
            return t_prob_cdf_gt(mean, stdev, gt)
        end
    end
</script>

        <!-- Stats helpers -->
        <script src="./jstat_1.9.6.min.js"></script>
        <!-- Hyperscript! :) -->
        <script src="./hyperscript_0.9.9.js"></script>
    </body>
</html>

